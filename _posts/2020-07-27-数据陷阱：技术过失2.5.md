---
layout:     post
title:      数据陷阱：技术过失2.5
subtitle:   陷阱：荒谬的百分比
date:       2020-07-27
author:     刘政永Dmer
header-img: img/post-bg-dmers.jpg
catalog: true
tags:
    - 听取树蛙一篇
---

## 陷阱：荒谬的百分比

这个所谓的新话题是为了说明当我们分析数据时，数学上的错误会以另一种方式把我们引入歧途。 下面这个例子处理的是百分比，也颇有其棘手之处。 每年，世界银行都会编制并发布一套数据，估计每个国家居住在城市环境中的人口比例。

在此先感恩一下世界银行的数据团队。

世界银行网站上显示的时间轴显示，全球城市人口占总人口的比例从1960年的33.6%上升到2016年的54.3%。 在这个网站上可以下载这一比例的数据集（数据来自https://data.worldbank.org/indicator/SP.URB.TOTL.IN.ZS），让我们深入研究一个国家和地区的数据。

有了这些数据，我们可以创建一个简单的世界地图，显示2016年每个国家据称居住在城市环境的百分比(图4.16)。 这张地图使用绿色调来显示城市人口较低的国家(黄色和浅绿色)和城市人口较高的国家(蓝色到紫色)。

![]({{site.baseurl}}/img/post-bg-bfs1.jpg)

看下非洲的那个黄色国家，那就是厄立特里亚( Eritrea), 城市人口真的是0%吗?真的就是绿色调色板中亮黄色的对应值?

实际上，这并不是地图上唯一的亮黄色国家，还有科索沃和圣马丁( Kosovo and Saint Martin)。 其中科索沃是一个部分得到承认的国家，圣马丁是法国的海外集合体， 但厄立特里亚是非洲联盟和联合国的成员国,其最大城市阿斯马拉约有65万居民。

在刚刚下载的世界银行数据集种，这三个国家的值是空的。 为null的原因还不完全清楚，但不管原因是什么， Tableau默认这两个国家的null值为0%，就厄立特里亚而言， 这对地图的观察者是一种误导(图4.17)。

![]({{site.baseurl}}/img/post-bg-bfs2.jpg)

将这三个国家从地图中排除，再看下其他国家的数据(图4.18)。

![]({{site.baseurl}}/img/post-bg-bfs3.jpg)

还不错——现在的地图靠谱多了， 但是如果想从地区层面而不是国家层面来分析城市人口的百分比会怎样呢?例如，2016年北美有多少人住在一个城市?

幸运的是，世界银行为每个国家都提供了一个区域数据字段，北美地区包括美国，加拿大和百慕大(墨西哥被包括在拉丁美洲和加勒比地区)。我们可以快速列出这三个国家的城市人口百分比，如图4.19所示。

![]({{site.baseurl}}/img/post-bg-bfs4.jpg)

但是我们如何从这三个国家层面的数字中确定整个地区的百分比呢?显然，把它们加起来得到263.80%是不明智的， 按理说没有人会把没有这样公分母的百分比加起来，其实呢，这样的人也有若干。

还有人认为，答案是可以通过求这些值的平均值来估计的。 因此，北美三个国家的简单算术平均值可以得到263.80%，然后除以3。 这样做时，计算出该地区城市人口的平均百分比为87.93%(图4.20)。

![]({{site.baseurl}}/img/post-bg-bfs5.jpg)

完事大吉？非也。真的不能以这种方式把这些比例数据结合起来。

这个问题与每个百分比都是两个数字的商有关。 每个商的分子是居住在那个特定国家的城市环境中的人数， 分母是那个特定国家的总人口。分母不一样，加的不是同一类别的东西。 误差很难估计，不要认为数据工具上什么的数据都是合理的，如下图。

![]({{site.baseurl}}/img/post-bg-bfs6.jpg)

换句话说，只有在每个国家的人口都完全相同的情况下，才能合理地把商相加。 此时甚至不知道每个国家的人口，因为这些数据并不包括在下载的数据中。

至此，似乎陷入了僵局，无法在地区层面找到答案。仅凭这个数据集，确实不能。 这里有个错误思维方式，人们会认为似乎现有数据应该能够在地区层面上回答这个问题： 每个国家都有一个值，并且每个国家都被划分为区域；这是很简单的聚合，误差会有那么大么? 就这样以侥幸心理，又为简单计算过程所诱惑，而慢慢的“成功”入坑。

如果我们分析的不是比率、或百分比，比如总人口， 那么就可以精确的进行汇总，并在区域层面回答问题，也不需要担心那些与非商值匹配的分母。

结果是，总人口数据集是一个缺失的关键，有它可以帮助解决关于城市人口百分比的区域问题。 幸运的是，世界银行还发布了一套单独的数据集（可见https://data.worldbank.org/indicator/SP.POP.TOTL），其中包括每个国家在一段时间内的人口总数。再次感恩世界银行的数据团队。

把现有数据集与国家人口的数据集进行合并，这样做可以马上告诉我们为什么最初的算术平均方法会遇到麻烦 ——这三个国家的人口有很大的不同(图4.22)

![]({{site.baseurl}}/img/post-bg-bfs7.jpg)

使用这个表格，就可以相当直接地确定区域商数的分母——北美总人口(由世界银行定义)。 我们可以把最后一列的这三个数相加得到359,457,493。

现在需要的是每个国家的城市人口总数，可以用城市人口百分比乘以每个国家的总人口来估计。 有了这个，可以很容易地计算区域商，通过这两个数字除以一起得到81.81%(图4.23)。

![]({{site.baseurl}}/img/post-bg-bfs8.jpg)

看这张表，我们可以看到城市人口的区域百分比非常接近美国的值。 准确地说，它只比美国的价值高出百分之二。其原因现在显而易见:美国主导着该地区的人口，几乎90%的居民居住在那里。 百慕大100%的居民都生活在城市中，其人口只占该地区总人口的不到0.02%。 因此，在确定区域平均水平时给予它们同等的权重根本就不准确。

另一种方法是将这三个国家分别放在城市人口与城市人口百分比的散点图上， 按人口大小划分圆圈， 并将这两种计算方法，也就是正确和不正确的区域百分比相加(图4.24)。

![]({{site.baseurl}}/img/post-bg-bfs9.jpg)

对于北美来说，展示这个陷阱以及如何一步步避免是很方便的， 因为该地区只列出了三个国家，所以整个区域表很容易展示出来。 如果对世界银行数据集中的每个地区都进行类似的分析，可以创建如图4.25所示的斜坡图， 如下图显示各地区正确百分比和不正确的对比。 请注意，对拉丁美洲和加勒比地区的采取对百分比求均值的预测是多么的错误， 把人口因素考虑进去，而不是仅仅对每个国家的百分比进行平均， 该地区的城市化率从65%上升到80%以上。

![]({{site.baseurl}}/img/post-bg-bfs10.jpg)

这似乎是一个小问题，讲过之后，有人会感觉不会再掉进这个陷阱了。 但其实很多人还是会忽视这些迹象，而一头栽进其中。每次发现自己已经在坑里的时候，真是欲哭无泪。 慢慢练习吧，渐渐会有较好的识别能力。在聚合或者汇总百分比和比例时要非常小心，这的确是一件棘手的事情。

本文转载于知乎海数据实验室。