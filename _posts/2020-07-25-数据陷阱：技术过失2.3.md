---
layout:     post
title:      数据陷阱：技术过失2.3
subtitle:   陷阱：不一致的单位
date:       2020-07-25
author:     刘政永Dmer
header-img: img/post-bg-dmers.jpg
catalog: true
tags:
    - 听取树蛙一篇
---

## 陷阱：不一致的单位

这也是一常见陷阱，与我们测量事物的方式有关。 当我们对数据中的不同度量进行数学运算时，需要确保知道所涉及的度量单位都是什么。 如果不小心，就可能碰到单位不一致的情况，然后得到非常错位的结果。

在前面，已经提到了火星气候轨道器解体这个的例子。当时的情况是，轨道飞行器飞得离火星表面太近了，承受压力过大，即将被烧成灰烬。 造成这一错误轨迹的原因是，洛克希德·马丁公司在提供的一个软件系统中，所输出推力器的发射脉冲是以磅力秒(pound-force second)计算的， 而美国宇航局创建的另一个系统，则根据每个系统的规格以牛顿秒(newton seconds)计算。一磅力等于4.45牛顿， 所以计算得出的推力比轨道飞行器保持在安全高度所需的推力要小得多。这次任务的总成本为3.274亿美元自然全部损失,而更大的损失则是失去了许多关于火星的宝贵信息。

Ben Jones,上世纪90年代末在加州大学洛杉矶分校(University of California at Los Angeles)就读工程学院时，度量单位是一件很重要的事情。 作为学生，他们经常被要求在作业、实验和考试中从国际单位制(IS，法语国际单位制的缩写)转换为英语工程单位，反之亦然。忘记转换单位是新手常犯的错误,而这种现象或问题在实际工作中也以不同程度存在着。

目前世界上只有三个国家没有使用国际单位制:利比里亚、缅甸和美国。 试想一下，如果你生活在古代，当你去邻近的城镇旅行时，你会遇到完全不一样的长度、质量和时间的测量系统， 这通常是根据当地封建领主的拇指大小或足长之类的东西确定的。

所以要感谢法国大革命，因为它促成了绝大部分国家采用一套共同计量单位。现在美国要达到这一目标，每更换一个路标，一部法律， 一个监管要求，一个包装标签的成本都将是巨大的，而且这些成本将持续几年甚至几十年。 但从长远来看，减少错误、简化跨境贸易和国际交流能够节省很多成本, 还能让数据陷阱变得不那么危险。

对于那些不是工程师或科学家的朋友，可能正坐在哪里自言自语: “我真庆幸不用担心这个问题!”毕竟，我又不用去设计火星轨道器或漫游者或类似的复杂东西。”

首先，让我们承认设计火星轨道飞行器，漫游者之类的,复杂是复杂,但还是挺酷的。第二，即使不做这些，你还是会涉及各种单位的事情。 比如，你是否曾在盘子里放一汤匙盐，而不是食谱中要求的一茶匙?这里面的容量差别到底是多少？

以下是Ben Jones列举他自己在这些情况下，包括商业在内，曾经陷入这种糟糕陷阱的10种不同方式，还是颇具一定代表性的:

1.用不同货币计算成本或收入:美元、欧元、人民币，日元
2.用不同的度量单位计算库存
3.温度比较:摄氏温度、华氏温度(开尔文温度)
4.用各种数量做数学运算，比如使用K(数千)、M(百万)和B(数十亿)
5.使用纬度和经度以度数分秒(DMS)和十进制度数(dd)处理位置数据
6.使用笛卡尔坐标(x,y)与极坐标(r，线性)处理二维空间位置
7.处理角度与弧度
8.用十六进制、十进制或二进制计算或做数学
9.确定发货日期时，涉及日历日和工作日

上面列出的这些项目中有一些是相当棘手的，也并不少见。 以最后一个为例——运输时间。我的包裹什么时候到?把周末和假期也考虑进去了吗?是中国的假期，还是需要考虑美国，加拿大或英国的假期? 从技术上讲，测量的基本单位无论如何都是一天，但我们是以特定类型的天为单位来测量时间的。 这可能看起来像一个技术细节，但可能决定着在我们的旅行途中，能否按时收到需要的包裹。

跌入这个陷阱的根本原因是盲目深入数据集，而不花时间去先查阅元数据表。 元数据很重要，可以帮助我们理解到底在处理什么，以及严格记录所创建数据集的重要性。 数据字段可能名为shipping time，但该字段的操作定义是什么?另一个数据字段可能名为quantity， 但它是以单位、容器或其他形式度量的吗?还有一个数据字段叫price，但是货币单位是什么呢?

查询元数据是必要的。 标准的数据集都要经过严格的文档化，每个领域都有详细的描述， 以回应度量单位问题，而花些时间去下定义是值得的。

需要注意的一个细节是，有时数据集会有一个包含不同单位记录的字段，一个混合数据字段。 在这些情况下，通常会有第二个伴随列或数据字段，为每个字段指定度量单位。 这些是特别复杂的情况，我们可能需要编写基于度量单位(通常是UoM)字段的IF/THEN计算， 以便在执行简单的聚合计算(如Sum和Average)之前将所有值转换为公共单位。

本文转载于知乎海数据实验室。