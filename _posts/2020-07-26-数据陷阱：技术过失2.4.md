---
layout:     post
title:      数据陷阱：技术过失2.4
subtitle:   陷阱：麻烦的总计
date:       2020-07-26
author:     刘政永Dmer
header-img: img/post-bg-dmers.jpg
catalog: true
tags:
    - 听取树蛙一篇
---
## 陷阱：麻烦的总计

Ben Jones, 也就是Aoiding Data Pitfalls的作者,在这部书中坦言: 他与这个陷阱有一种特殊的因缘，因为有一次他实际上是在警告人们如何避免这个陷阱的时候,掉进里面的。 此后，他被迫学会了自嘲。就在前几年，他在南加州大学(University of Southern California)为专攻健康数据的记者们举办了一个培训课程，并向其提到正在写这本书的这一章，还强调在演讲和研讨会期间，会提醒他们如何注意各种各样的陷阱。

在进行培训时，只要有可能，Ben更喜欢使用听众感兴趣或与其工作相关的数据。 这里面有风险，因为这意味着将向听众展示一个他们熟悉的话题的数据，而培训者自身却不一定熟悉。 实际上这件事很有意思的，因为培训者也会成为学习者，Ben认为：在听众向我学习如何使用数据的同时，我也会向他们提出了有关领域的问题。

因为这次特别的研讨会，是在Ben的家乡---加利福尼亚州举办的，他选择将2001年到2015年间加州居民感染的传染病数据 （数据由加州公共卫生部门的传染病中心提供,可见https://data.chhs.ca.gov/dataset/infectious-disease-cases-by-countyyear-and-sex.)。按照县（county）、年份(year）和性别（sex）进行分类。讲过了一个很蹩脚的笑话之后，他开始讲解将如何使用很脏的数据来工作，然后正式的内容开始了。

对这些数据提出的第一个问题很简单:在这段时间里，据报道， 加州居民总共感染了多少种传染病?通过统计数据集中的记录数， 得到的答案是15,002,836，如下图所示

![]({{site.baseurl}}/img/post-bg-zj1.jpg)

Ben知道，这完全是一个圈套。他之前已经看过了数据，感觉这个文件的结构有些古怪。 每个县、年份和疾病组合在电子表格中有三行:一行是男性居民，一行是女性居民， 另一行是居民总数，即男性加女性。图4.12是数据集中前10个条目的快照。

![]({{site.baseurl}}/img/post-bg-zj2.jpg)

那么，这意味着在Count列的用一个简单的求和函数将造成重复计算。加州男性居民每感染一种疾病都会被计算两次， 一次在性别等于“男性”的那一行，另一次在性别等于“总数”的那一行；女性也是如此。

在研讨会上Ben接着问这些记者，关于在加州报道的传染病，他们还想知道些什么。 于是，观众席中一个初出苗头的数据记者举起手，好像是提前准备好的，问道，“是否男性和女性的感染数量偏多了?”

Ben非常常规的点了点头，说这真是一个了不起的问题， 并提示听证要通过在颜色编码中添加性别来寻找答案，如图4.13所示。

![]({{site.baseurl}}/img/post-bg-zj3.jpg)

教室里沉默了片刻，困惑的学生们看着图，而Ben，则用一种可能很不令人信服的方式，假装对结果感到震惊。他说：“这是什么呢?是在性别属性中有一个名为Total的值，占已报告疾病总数的50%。这意味着我们重复计算了，不是吗?从2001年到2015年，加州报告的传染病病例为1500万， 但实际只有这个数字的一半，大约750万。我们的第一个答案差了2倍!我告诉过你，我们会掉进陷阱的；这种错误称为非法侵入总数（Trespassing Totals）。

Ben的演讲部分结束了，学生们也认为自己得到了适当的警告，Ben也自认为相当聪明。 之后他继续对同样的数据集进行分析。 为了探究下按县计算的传染病数量，他做了如下一张图

![]({{site.baseurl}}/img/post-bg-zj4.jpg)

这时一个学员问:“嘿，Ben，地图右下角的那条未知信息是什么意思?”

一开始Ben并没有注意到它， 就点进去看下，想了一会儿，不禁微笑。每个县的每一种疾病和年份组合都有一行， 但加州县增加了一行(如下图所示)。

![]({{site.baseurl}}/img/post-bg-zj5.jpg)

为什么呢?纽约州有一个纽约州的县，但加州肯定没有加州县。 可以想象，创建和发布数据集的人想要提供每一种疾病和年份组合的一行， 使得所有县的报告病例加可以在一起，他们使用州名作为“所有县”的占位符。

Ben承认，这个事实本身并不是很有趣。最初的问题---总共报道了多少传染病---的答案是1500万，但不是差了2倍， 而是差了4倍!实际数字不是750万，而是374万。 因为各种总行数，每个性别计算了两次，然后为每个县又计算了两次。 Ben身体力行，向学员们显示了他掉进的陷阱比想象的要深两倍。数据确实总有办法羞辱我们，不是吗？

在之前的文章中，我们已经看到过汇总数据时，如何导致某些类别为空或null，以及当依赖于软件默认值而没有足够仔细地查看视图时， 有时会如何错过重要的信息；这里还看到了数据中令人讨厌的总行数是如何出现的，甚至可以使最简单的答案出错一个数量级。

我们需要意识到做数据时的这些问题，然后再对所持观点和分析结果给出适当结论。如果不探索数据的外部轮廓及其内部信息， 就有可能认定某些实际上并不存在的趋势存在，也有可能错过一些关键信息。

汇总或聚合数据是一种相对简单的数学操作(有些人认为非常琐碎)，但我们已经看到，即使是这些基本步骤也可能非常棘手。 下面考虑一下，当做一些稍微复杂一点点的数学上时会发生什么，比如下一节会涉及处理比率的事情。

本文转载于知乎海数据实验室。